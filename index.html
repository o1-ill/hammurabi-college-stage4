<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© ÙˆØªÙ†Ø¸ÙŠÙ… Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø±Ø§Ø¨Ø¹Ø© ÙÙŠ Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø¯Ø±Ø§Ø³ÙŠØ©">
    <meta name="keywords" content="Ø·Ù„Ø§Ø¨, Ù…Ø¬Ù…ÙˆØ¹Ø§Øª, ØªÙ†Ø¸ÙŠÙ…, Ø¥Ø¯Ø§Ø±Ø©, Ø¬Ø§Ù…Ø¹Ø©">
    <meta name="author" content="Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>ØªÙ‚Ø³ÙŠÙ… Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø±Ø§Ø¨Ø¹Ø©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'cairo': ['Cairo', 'sans-serif'],
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'glow': 'glow 2s ease-in-out infinite alternate',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'bounce-slow': 'bounce 3s infinite',
                        'gradient': 'gradient 15s ease infinite',
                    }
                }
            }
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" integrity="sha512-r22gChDnGvBylk90+2e/ycr3RVrDi8DIOkIGNhJlKfuyQM4tIRAI062MaV8sfjQKYVGjOBaZBOA87z+IhZE9DA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
    <!-- Firebase App (core SDK) -->
    <script src="https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js"></script>
    
    <!-- Firebase Realtime Database -->
    <script src="https://www.gstatic.com/firebasejs/12.2.1/firebase-database.js"></script>
    
    <!-- Firebase Analytics (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) -->
    <script src="https://www.gstatic.com/firebasejs/12.2.1/firebase-analytics.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Cairo', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            font-family: 'Cairo', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(-45deg, #667eea, #764ba2, #f093fb, #f5576c, #4facfe, #00f2fe);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
            min-height: 100vh;
        }
        
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        @keyframes glow {
            from { box-shadow: 0 0 20px rgba(255, 255, 255, 0.2); }
            to { box-shadow: 0 0 30px rgba(255, 255, 255, 0.4), 0 0 40px rgba(255, 255, 255, 0.2); }
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 25px 45px rgba(0, 0, 0, 0.1);
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .glass-card:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-10px);
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.2);
        }
        
        .stats-card-1 {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .stats-card-2 {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .stats-card-3 {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        .stats-card-4 {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }
        
        .floating-element {
            animation: float 6s ease-in-out infinite;
        }
        
        .modern-input {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        
        .modern-input:focus {
            background: rgba(255, 255, 255, 0.95);
            border-color: #667eea;
            box-shadow: 0 0 30px rgba(102, 126, 234, 0.3);
        }
        
        .modern-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .modern-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 20px 40px rgba(102, 126, 234, 0.4);
        }
        
        .modern-button:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .modern-button:hover:before {
            left: 100%;
        }
        
        .table-modern {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .table-modern th {
            background: rgba(102, 126, 234, 0.2);
            color: #1f2937;
            font-weight: 700;
        }
        
        .table-modern tr:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .modal-backdrop {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
        }
        
        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .group-card-empty {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.8) 0%, rgba(21, 128, 61, 0.8) 100%);
            color: white;
        }
        
        .group-card-partial {
            background: linear-gradient(135deg, rgba(234, 179, 8, 0.8) 0%, rgba(161, 98, 7, 0.8) 100%);
            color: white;
        }
        
        .group-card-full {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.8) 0%, rgba(185, 28, 28, 0.8) 100%);
            color: white;
        }
        
        .connection-status {
            animation: pulse-slow 3s infinite;
        }
        
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        
        .admin-panel {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .glow-animation {
            animation: glow 3s ease-in-out;
        }
        
        .success-modal {
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateY(-100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .fade-out {
            animation: fadeOut 0.5s ease-in forwards;
        }
        
        @keyframes fadeOut {
            to { opacity: 0; transform: translateY(-20px); }
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-left: 8px;
        }
        
        .status-full { background-color: #ef4444; }
        .status-empty { background-color: #22c55e; }
        .status-partial { background-color: #eab308; }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }
        
        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ø¹Ù†Ø§ØµØ± */
        .neon-glow {
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.5);
        }
        
        .pulse-glow {
            animation: pulse-glow 2s infinite;
        }
        
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(102, 126, 234, 0.3); }
            50% { box-shadow: 0 0 40px rgba(102, 126, 234, 0.8); }
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Header -->
    <header class="glass-effect text-white py-12 shadow-2xl relative overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-r from-purple-600/20 to-blue-600/20"></div>
        <div class="container mx-auto px-6 relative z-10">
            <div class="flex justify-between items-center mb-6">
                <div class="floating-element">
                    <div class="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center backdrop-blur-sm">
                        <span class="text-3xl">ğŸ“</span>
                    </div>
                </div>
                <div id="connectionStatus" class="connection-status flex items-center gap-3 text-sm font-medium bg-white/10 px-4 py-2 rounded-full backdrop-blur-sm">
                    <span class="w-3 h-3 rounded-full bg-yellow-400 animate-pulse"></span>
                    <span>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...</span>
                </div>
            </div>
            <div class="text-center">
                <h1 class="text-6xl font-black mb-4 text-white drop-shadow-2xl">
                    ØªÙ‚Ø³ÙŠÙ… Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø±Ø§Ø¨Ø¹Ø©
                </h1>
                <p class="text-xl text-white/90 font-medium">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© ÙˆØªÙ†Ø¸ÙŠÙ… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© Ø§Ù„Ù…ØªØ·ÙˆØ±</p>
                <div class="w-32 h-1 bg-white/50 rounded-full mx-auto mt-6"></div>
            </div>
        </div>
    </header>

    <!-- Statistics -->
    <div class="container mx-auto px-6 py-12">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-16">
            <div class="stats-card-1 text-white p-8 rounded-3xl shadow-2xl card-hover glass-card neon-glow">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm opacity-90 font-semibold mb-3 uppercase tracking-wider">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø§Ø¨</p>
                        <p class="text-4xl font-black mb-2" id="totalStudents">0</p>
                        <div class="w-16 h-1 bg-white/40 rounded-full"></div>
                    </div>
                    <div class="text-5xl floating-element opacity-80">ğŸ‘¥</div>
                </div>
            </div>
            
            <div class="stats-card-2 text-white p-8 rounded-3xl shadow-2xl card-hover glass-card neon-glow">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm opacity-90 font-semibold mb-3 uppercase tracking-wider">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</p>
                        <p class="text-4xl font-black mb-2" id="fullGroups">0</p>
                        <div class="w-16 h-1 bg-white/40 rounded-full"></div>
                    </div>
                    <div class="text-5xl floating-element opacity-80">âœ…</div>
                </div>
            </div>
            
            <div class="stats-card-3 text-white p-8 rounded-3xl shadow-2xl card-hover glass-card neon-glow">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm opacity-90 font-semibold mb-3 uppercase tracking-wider">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ø¬Ø²Ø¦ÙŠØ©</p>
                        <p class="text-4xl font-black mb-2" id="partialGroups">0</p>
                        <div class="w-16 h-1 bg-white/40 rounded-full"></div>
                    </div>
                    <div class="text-5xl floating-element opacity-80">âš ï¸</div>
                </div>
            </div>
            
            <div class="stats-card-4 text-white p-8 rounded-3xl shadow-2xl card-hover glass-card neon-glow">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm opacity-90 font-semibold mb-3 uppercase tracking-wider">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„ÙØ§Ø±ØºØ©</p>
                        <p class="text-4xl font-black mb-2" id="emptyGroups">20</p>
                        <div class="w-16 h-1 bg-white/40 rounded-full"></div>
                    </div>
                    <div class="text-5xl floating-element opacity-80">ğŸ“</div>
                </div>
            </div>
        </div>

        <!-- Groups Overview Table -->
        <div class="glass-effect rounded-3xl shadow-2xl p-10 mb-16 neon-glow">
            <div class="flex items-center gap-6 mb-10">
                <div class="w-16 h-16 bg-gradient-to-r from-blue-500 to-purple-600 rounded-3xl flex items-center justify-center shadow-lg floating-element">
                    <span class="text-3xl">ğŸ“Š</span>
                </div>
                <div>
                    <h2 class="text-4xl font-black gradient-text mb-2">Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª</h2>
                    <p class="text-white/80 text-lg">ØªÙØ§ØµÙŠÙ„ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ù…Ø®ØªÙ„ÙØ©</p>
                </div>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-center table-modern rounded-2xl overflow-hidden shadow-xl">
                    <thead>
                        <tr class="table-modern">
                            <th class="py-6 px-8 font-black text-lg text-white">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</th>
                            <th class="py-6 px-8 font-black text-lg text-white">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ©</th>
                            <th class="py-6 px-8 font-black text-lg text-white">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø©</th>
                            <th class="py-6 px-8 font-black text-lg text-white">Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨</th>
                            <th class="py-6 px-8 font-black text-lg text-white">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                        </tr>
                    </thead>
                    <tbody id="groupsTable">
                        <!-- Table content will be generated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Registration Form -->
        <div class="glass-effect rounded-3xl shadow-2xl p-12 mb-16 neon-glow">
            <div class="flex items-center gap-6 mb-10">
                <div class="w-16 h-16 bg-gradient-to-r from-green-500 to-blue-600 rounded-3xl flex items-center justify-center shadow-lg floating-element">
                    <span class="text-3xl">âœï¸</span>
                </div>
                <div>
                    <h2 class="text-4xl font-black gradient-text mb-2">ØªØ³Ø¬ÙŠÙ„ Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</h2>
                    <p class="text-white/80 text-lg">Ø£Ø¶Ù Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ø¥Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù…</p>
                </div>
            </div>
            <form id="studentForm" class="space-y-8">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div>
                        <label class="block text-white font-bold mb-4 text-xl">Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ *</label>
                        <input type="text" id="studentName" required 
                               class="modern-input w-full px-8 py-5 rounded-2xl focus:ring-4 focus:ring-blue-500/50 focus:border-transparent transition-all text-xl font-medium"
                               placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ Ù„Ù„Ø·Ø§Ù„Ø¨">
                    </div>
                    
                    <div>
                        <label class="block text-white font-bold mb-4 text-xl">Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                        <input type="password" id="studentPassword" 
                               class="modern-input w-full px-8 py-5 rounded-2xl focus:ring-4 focus:ring-blue-500/50 focus:border-transparent transition-all text-xl font-medium"
                               placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø³Ø±ÙŠ Ù„Ø­Ù…Ø§ÙŠØ© Ø¨ÙŠØ§Ù†Ø§ØªÙƒ">
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div>
                        <label class="block text-white font-bold mb-4 text-xl">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© *</label>
                        <select id="mainGroup" required 
                                class="modern-input w-full px-8 py-5 rounded-2xl focus:ring-4 focus:ring-blue-500/50 focus:border-transparent transition-all text-xl font-medium">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</option>
                            <option value="A1">A1</option>
                            <option value="A2">A2</option>
                            <option value="B1">B1</option>
                            <option value="B2">B2</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-white font-bold mb-4 text-xl">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ© *</label>
                        <select id="subGroup" required 
                                class="modern-input w-full px-8 py-5 rounded-2xl focus:ring-4 focus:ring-blue-500/50 focus:border-transparent transition-all text-xl font-medium">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ©</option>
                            <option value="1">Subgroup 1</option>
                            <option value="2">Subgroup 2</option>
                            <option value="3">Subgroup 3</option>
                            <option value="4">Subgroup 4</option>
                            <option value="5">Subgroup 5</option>
                        </select>
                    </div>
                </div>
                
                <button type="submit" 
                        class="modern-button w-full text-white py-6 px-10 rounded-2xl font-black text-2xl shadow-2xl pulse-glow">
                    ğŸš€ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ø¢Ù†
                </button>
            </form>
        </div>

        <!-- Admin Panel -->
        <div class="glass-effect rounded-3xl shadow-2xl p-12 mb-16 neon-glow">
            <div class="flex items-center gap-6 mb-10">
                <div class="w-16 h-16 bg-gradient-to-r from-red-500 to-pink-600 rounded-3xl flex items-center justify-center shadow-lg floating-element">
                    <span class="text-3xl">ğŸ”</span>
                </div>
                <div>
                    <h2 class="text-4xl font-black gradient-text mb-2">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h2>
                    <p class="text-white/80 text-lg">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…</p>
                </div>
            </div>
            <div class="flex flex-col sm:flex-row gap-6 mb-8">
                <input type="password" id="adminPassword" 
                       class="modern-input flex-1 px-8 py-5 rounded-2xl focus:ring-4 focus:ring-red-500/50 focus:border-transparent transition-all text-xl font-medium"
                       placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©">
                <button onclick="checkAdminAccess()" 
                        class="bg-gradient-to-r from-red-500 to-pink-600 text-white px-10 py-5 rounded-2xl font-bold hover:from-red-600 hover:to-pink-700 transition-all shadow-xl text-xl">
                    ğŸ”“ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
                </button>
            </div>
            
            <div id="adminPanel" class="admin-panel hidden p-8 rounded-2xl">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <button onclick="exportData()" 
                            class="bg-gradient-to-r from-green-500 to-emerald-600 text-white px-8 py-5 rounded-2xl font-bold hover:from-green-600 hover:to-emerald-700 transition-all flex items-center justify-center gap-4 shadow-xl text-lg">
                        ğŸ“Š ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    </button>
                    <label class="bg-gradient-to-r from-blue-500 to-cyan-600 text-white px-8 py-5 rounded-2xl font-bold hover:from-blue-600 hover:to-cyan-700 transition-all cursor-pointer flex items-center justify-center gap-4 shadow-xl text-lg">
                        ğŸ“ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        <input type="file" id="importFile" accept=".xlsx,.xls" class="hidden" onchange="importData(event)">
                    </label>
                    <button onclick="clearAllData()" 
                            class="bg-gradient-to-r from-red-500 to-rose-600 text-white px-8 py-5 rounded-2xl font-bold hover:from-red-600 hover:to-rose-700 transition-all flex items-center justify-center gap-4 shadow-xl text-lg">
                        ğŸ—‘ï¸ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    </button>
                </div>
            </div>
        </div>

        <!-- Students Display -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8" id="studentsDisplay">
            <!-- Students will be displayed here -->
        </div>
    </div>

    <!-- Loading Indicator -->
    <div id="loadingIndicator" class="modal-backdrop fixed inset-0 flex items-center justify-center z-50 hidden">
        <div class="modal-content rounded-3xl p-12 text-center shadow-2xl">
            <div class="animate-spin rounded-full h-20 w-20 border-4 border-blue-500 border-t-transparent mx-auto mb-8"></div>
            <p class="text-gray-700 text-xl font-bold">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...</p>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="modal-backdrop fixed inset-0 flex items-center justify-center z-50 hidden">
        <div class="success-modal modal-content rounded-3xl p-16 max-w-md mx-4 text-center shadow-2xl">
            <div class="text-8xl mb-8 floating-element">ğŸ‰</div>
            <h3 class="text-4xl font-black text-green-600 mb-6">ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!</h3>
            <p class="text-gray-600 text-xl font-medium">ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</p>
            <div class="w-20 h-2 bg-green-500 rounded-full mx-auto mt-8"></div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal-backdrop fixed inset-0 flex items-center justify-center z-50 hidden">
        <div class="modal-content rounded-3xl p-12 max-w-2xl mx-4 w-full shadow-2xl">
            <div class="flex items-center gap-6 mb-10">
                <div class="w-16 h-16 bg-gradient-to-r from-blue-500 to-purple-600 rounded-3xl flex items-center justify-center shadow-lg">
                    <span class="text-3xl">âœï¸</span>
                </div>
                <h3 class="text-3xl font-black gradient-text">ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨</h3>
            </div>
            <div id="editContent">
                <!-- Edit form will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Password Modal -->
    <div id="passwordModal" class="modal-backdrop fixed inset-0 flex items-center justify-center z-50 hidden">
        <div class="modal-content rounded-3xl p-12 max-w-md mx-4 w-full shadow-2xl">
            <div class="flex items-center gap-6 mb-10">
                <div class="w-16 h-16 bg-gradient-to-r from-yellow-500 to-orange-600 rounded-3xl flex items-center justify-center shadow-lg">
                    <span class="text-3xl">ğŸ”’</span>
                </div>
                <h3 class="text-3xl font-black gradient-text">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ</h3>
            </div>
            <input type="password" id="modalPassword" 
                   class="modern-input w-full px-8 py-5 rounded-2xl focus:ring-4 focus:ring-blue-500/50 focus:border-transparent mb-8 text-xl font-medium"
                   placeholder="Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ">
            <div class="flex gap-6">
                <button onclick="verifyPassword()" 
                        class="flex-1 bg-gradient-to-r from-blue-500 to-purple-600 text-white py-4 px-8 rounded-2xl font-bold hover:from-blue-600 hover:to-purple-700 transition-all shadow-xl text-lg">
                    âœ… ØªØ£ÙƒÙŠØ¯
                </button>
                <button onclick="closePasswordModal()" 
                        class="flex-1 bg-gradient-to-r from-gray-500 to-gray-600 text-white py-4 px-8 rounded-2xl font-bold hover:from-gray-600 hover:to-gray-700 transition-all shadow-xl text-lg">
                    âŒ Ø¥Ù„ØºØ§Ø¡
                </button>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCDZZqUzXRAwh3RKaGp1unIbUWYMWF2Q7s",
            authDomain: "hammurabi-ccf6d.firebaseapp.com",
            databaseURL: "https://hammurabi-ccf6d-default-rtdb.firebaseio.com",
            projectId: "hammurabi-ccf6d",
            storageBucket: "hammurabi-ccf6d.appspot.com",
            messagingSenderId: "257971367886",
            appId: "1:257971367886:web:761013b57defa59a3b459f",
            measurementId: "G-KS3SWR8LYC"
        };

        // Initialize Firebase
        let app, db;
        let isFirebaseConnected = false;
        
        try {
            app = firebase.initializeApp(firebaseConfig);
            db = firebase.database();
            isFirebaseConnected = true;
            console.log('Firebase Ù…ØªØµÙ„ Ø¨Ù†Ø¬Ø§Ø­');
            updateConnectionStatus(true);
        } catch (error) {
            console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Firebase:', error);
            isFirebaseConnected = false;
            updateConnectionStatus(false);
        }
        
        // Update connection status indicator
        function updateConnectionStatus(connected) {
            const statusElement = document.getElementById('connectionStatus');
            if (!statusElement) return;
            
            if (connected) {
                statusElement.innerHTML = `
                    <span class="w-3 h-3 rounded-full bg-green-400 shadow-lg"></span>
                    <span class="font-bold">Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…</span>
                `;
                statusElement.className = 'connection-status flex items-center gap-3 text-sm font-medium text-green-100 bg-green-500/20 px-4 py-2 rounded-full backdrop-blur-sm';
            } else {
                statusElement.innerHTML = `
                    <span class="w-3 h-3 rounded-full bg-red-400 animate-pulse shadow-lg"></span>
                    <span class="font-bold">ØºÙŠØ± Ù…ØªØµÙ„ (ÙˆØ¶Ø¹ Ù…Ø­Ù„ÙŠ)</span>
                `;
                statusElement.className = 'connection-status flex items-center gap-3 text-sm font-medium text-red-100 bg-red-500/20 px-4 py-2 rounded-full backdrop-blur-sm';
            }
        }

        // Global variables
        let students = [];
        let currentEditingStudent = null;
        let isAdminMode = false;
        const ADMIN_PASSWORD = 'qfvlu10178';

        // Error handling
        window.addEventListener('error', function(e) {
            console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚:', e.error);
        });

        // Firebase Functions
        function loadStudentsFromFirebase() {
            if (!isFirebaseConnected) {
                // Fallback to localStorage
                students = JSON.parse(localStorage.getItem('students')) || [];
                return Promise.resolve();
            }
            
            return db.ref('students').once('value')
                .then(snapshot => {
                    const data = snapshot.val();
                    students = data ? Object.values(data) : [];
                    console.log('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase:', students.length, 'Ø·Ø§Ù„Ø¨');
                })
                .catch(error => {
                    console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase:', error);
                    // Fallback to localStorage
                    students = JSON.parse(localStorage.getItem('students')) || [];
                });
        }
        
        function saveStudentsToFirebase() {
            if (!isFirebaseConnected) {
                // Fallback to localStorage
                localStorage.setItem('students', JSON.stringify(students));
                return Promise.resolve();
            }
            
            // Convert array to object with IDs as keys for Firebase
            const studentsObj = {};
            students.forEach(student => {
                studentsObj[student.id] = student;
            });
            
            return db.ref('students').set(studentsObj)
                .then(() => {
                    console.log('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Firebase');
                    // Also save to localStorage as backup
                    localStorage.setItem('students', JSON.stringify(students));
                })
                .catch(error => {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Firebase:', error);
                    // Fallback to localStorage
                    localStorage.setItem('students', JSON.stringify(students));
                });
        }
        
        function syncWithFirebase() {
            if (!isFirebaseConnected) return;
            
            // Monitor connection status
            db.ref('.info/connected').on('value', snapshot => {
                const connected = snapshot.val();
                updateConnectionStatus(connected);
                isFirebaseConnected = connected;
            });
            
            // Listen for real-time updates
            db.ref('students').on('value', snapshot => {
                const data = snapshot.val();
                const firebaseStudents = data ? Object.values(data) : [];
                
                // Only update if data is different
                if (JSON.stringify(firebaseStudents) !== JSON.stringify(students)) {
                    students = firebaseStudents;
                    displayStudents();
                    generateGroupsTable();
                    updateStatistics();
                    console.log('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase');
                }
            });
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            try {
                // Load data from Firebase first
                loadStudentsFromFirebase().then(() => {
                    generateGroupsTable();
                    displayStudents();
                    updateStatistics();
                    
                    // Start real-time sync
                    syncWithFirebase();
                });
                
                // Form submission
                document.getElementById('studentForm').addEventListener('submit', function(e) {
                    e.preventDefault();
                    addStudent();
                });
                
                // Check if localStorage is available
                if (typeof(Storage) === "undefined") {
                    alert('Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ. Ù‚Ø¯ Ù„Ø§ ØªØ¹Ù…Ù„ Ø¨Ø¹Ø¶ Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­.');
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚. ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©.');
            }
        });

        // Generate groups table
        function generateGroupsTable() {
            const tableBody = document.getElementById('groupsTable');
            const mainGroups = ['A', 'B'];
            const subGroups = ['1', '2'];
            const subSubGroups = ['1', '2', '3', '4', '5'];
            
            let html = '';
            
            mainGroups.forEach(main => {
                subGroups.forEach(sub => {
                    const groupName = main + sub;
                    subSubGroups.forEach((subSub, index) => {
                        const fullGroupName = groupName + '-' + subSub;
                        const studentsInGroup = students.filter(s => 
                            s.mainGroup === groupName && s.subGroup === subSub
                        );
                        const count = studentsInGroup.length;
                        const maxCount = 10;
                        
                        let statusClass = 'status-empty';
                        let statusText = 'ÙØ§Ø±ØºØ©';
                        
                        if (count === maxCount) {
                            statusClass = 'status-full';
                            statusText = 'Ù…ÙƒØªÙ…Ù„Ø©';
                        } else if (count > 0) {
                            statusClass = 'status-partial';
                            statusText = 'Ø¬Ø²Ø¦ÙŠØ©';
                        }
                        
                        html += `
                            <tr class="border-b border-white/10 hover:bg-white/10 transition-all">
                                ${index === 0 ? `<td rowspan="5" class="py-6 px-6 font-black text-xl bg-blue-500/20 text-white">${main}</td>` : ''}
                                ${index === 0 ? `<td rowspan="5" class="py-6 px-6 font-bold text-lg bg-blue-500/10 text-white">${groupName}</td>` : ''}
                                <td class="py-4 px-6 text-white font-medium">Subgroup ${subSub}</td>
                                <td class="py-4 px-6 font-bold text-lg text-white">${count}/${maxCount}</td>
                                <td class="py-4 px-6">
                                    <span class="status-indicator ${statusClass}"></span>
                                    <span class="text-sm font-medium text-white">${statusText}</span>
                                </td>
                            </tr>
                        `;
                    });
                });
            });
            
            tableBody.innerHTML = html;
        }

        // Add student
        function addStudent() {
            const name = document.getElementById('studentName').value.trim();
            const password = document.getElementById('studentPassword').value;
            const mainGroup = document.getElementById('mainGroup').value;
            const subGroup = document.getElementById('subGroup').value;
            
            if (!name || !mainGroup || !subGroup) {
                alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                return;
            }
            
            // Check if subgroup is full
            const studentsInSubgroup = students.filter(s => 
                s.mainGroup === mainGroup && s.subGroup === subGroup
            );
            
            if (studentsInSubgroup.length >= 10) {
                alert('Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ© Ù…ÙƒØªÙ…Ù„Ø© (10 Ø·Ù„Ø§Ø¨). ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¬Ù…ÙˆØ¹Ø© Ø£Ø®Ø±Ù‰.');
                return;
            }
            
            // Check if student already exists
            const existingStudent = students.find(s => s.name === name);
            if (existingStudent) {
                alert('Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù… Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹');
                return;
            }
            
            const student = {
                id: Date.now(),
                name: name,
                password: password,
                mainGroup: mainGroup,
                subGroup: subGroup,
                registrationDate: new Date().toLocaleDateString('ar-SA')
            };
            
            students.push(student);
            
            // Save to Firebase and localStorage
            saveStudentsToFirebase().then(() => {
                // Show success animation
                showSuccessModal();
            }).catch(error => {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø·Ø§Ù„Ø¨:', error);
                alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨ Ù…Ø­Ù„ÙŠØ§Ù‹ØŒ Ù„ÙƒÙ† Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Ø§Ù„Ø®Ø§Ø¯Ù…');
                showSuccessModal();
            });
            
            // Reset form
            document.getElementById('studentForm').reset();
            
            // Update displays
            displayStudents();
            generateGroupsTable();
            updateStatistics();
            
            // Highlight the student's group
            highlightStudentGroup(student);
        }

        // Show/hide loading indicator
        function showLoading() {
            document.getElementById('loadingIndicator').classList.remove('hidden');
        }
        
        function hideLoading() {
            document.getElementById('loadingIndicator').classList.add('hidden');
        }

        // Show success modal
        function showSuccessModal() {
            const modal = document.getElementById('successModal');
            modal.classList.remove('hidden');
            
            setTimeout(() => {
                modal.classList.add('fade-out');
                setTimeout(() => {
                    modal.classList.add('hidden');
                    modal.classList.remove('fade-out');
                }, 500);
            }, 3000);
        }

        // Highlight student group
        function highlightStudentGroup(student) {
            const groupCards = document.querySelectorAll(`[data-group="${student.mainGroup}-${student.subGroup}"]`);
            groupCards.forEach(card => {
                card.classList.add('glow-animation');
                setTimeout(() => {
                    card.classList.remove('glow-animation');
                }, 3000);
            });
        }

        // Display students
        function displayStudents() {
            const container = document.getElementById('studentsDisplay');
            const groups = {};
            
            // Group students by main group and subgroup
            students.forEach(student => {
                const key = `${student.mainGroup}-${student.subGroup}`;
                if (!groups[key]) {
                    groups[key] = [];
                }
                groups[key].push(student);
            });
            
            let html = '';
            
            // Create cards for all possible groups
            const mainGroups = ['A1', 'A2', 'B1', 'B2'];
            const subGroups = ['1', '2', '3', '4', '5'];
            
            mainGroups.forEach(mainGroup => {
                subGroups.forEach(subGroup => {
                    const key = `${mainGroup}-${subGroup}`;
                    const groupStudents = groups[key] || [];
                    const count = groupStudents.length;
                    const maxCount = 10;
                    
                    let cardClass = 'group-card-empty';
                    let statusIcon = 'ğŸŸ¢';
                    let statusText = 'ÙØ§Ø±ØºØ©';
                    
                    if (count === maxCount) {
                        cardClass = 'group-card-full';
                        statusIcon = 'ğŸ”´';
                        statusText = 'Ù…ÙƒØªÙ…Ù„Ø©';
                    } else if (count > 0) {
                        cardClass = 'group-card-partial';
                        statusIcon = 'ğŸŸ¡';
                        statusText = 'Ø¬Ø²Ø¦ÙŠØ©';
                    }
                    
                    html += `
                        <div class="${cardClass} rounded-3xl shadow-2xl p-8 card-hover glass-card neon-glow" data-group="${key}">
                            <div class="flex items-center justify-between mb-8">
                                <div>
                                    <h3 class="text-2xl font-black text-white mb-3">${mainGroup} - Subgroup ${subGroup}</h3>
                                    <div class="flex items-center gap-4">
                                        <span class="text-xl font-black text-white">${count}/${maxCount}</span>
                                        <span class="text-3xl">${statusIcon}</span>
                                        <span class="text-sm font-bold text-white bg-white/20 px-4 py-2 rounded-full backdrop-blur-sm">${statusText}</span>
                                    </div>
                                </div>
                                <div class="w-20 h-20 bg-white/20 rounded-3xl flex items-center justify-center backdrop-blur-sm floating-element">
                                    <span class="text-3xl">ğŸ‘¥</span>
                                </div>
                            </div>
                            <div class="space-y-4 max-h-80 overflow-y-auto scrollbar-hide">
                                ${groupStudents.map(student => `
                                    <div class="flex items-center justify-between bg-white/20 backdrop-filter backdrop-blur-sm rounded-2xl p-5 hover:bg-white/30 transition-all shadow-lg">
                                        <span class="flex items-center gap-4 text-white font-bold text-lg">
                                            <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center shadow-lg">
                                                <span class="text-white text-lg">ğŸ‘¤</span>
                                            </div>
                                            ${student.name}
                                        </span>
                                        <button onclick="editStudent(${student.id})" 
                                                class="w-12 h-12 bg-blue-500 hover:bg-blue-600 text-white rounded-2xl transition-all flex items-center justify-center shadow-xl hover:scale-110">
                                                <span class="text-lg">âœï¸</span>
                                        </button>
                                    </div>
                                `).join('')}
                                ${count === 0 ? '<div class="text-center py-12"><div class="text-8xl mb-6 opacity-60 floating-element">ğŸ“</div><p class="text-white/80 text-xl font-bold">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ Ù…Ø³Ø¬Ù„ÙŠÙ†</p></div>' : ''}
                            </div>
                        </div>
                    `;
                });
            });
            
            container.innerHTML = html;
        }

        // Edit student
        function editStudent(studentId) {
            const student = students.find(s => s.id === studentId);
            if (!student) return;
            
            currentEditingStudent = student;
            
            if (student.password && !isAdminMode) {
                showPasswordModal();
            } else {
                showEditModal(student);
            }
        }

        // Show password modal
        function showPasswordModal() {
            document.getElementById('passwordModal').classList.remove('hidden');
            document.getElementById('modalPassword').focus();
        }

        // Close password modal
        function closePasswordModal() {
            document.getElementById('passwordModal').classList.add('hidden');
            document.getElementById('modalPassword').value = '';
        }

        // Verify password
        function verifyPassword() {
            const enteredPassword = document.getElementById('modalPassword').value;
            
            if (enteredPassword === currentEditingStudent.password) {
                closePasswordModal();
                showEditModal(currentEditingStudent);
            } else {
                alert('Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­');
            }
        }

        // Show edit modal
        function showEditModal(student) {
            const modal = document.getElementById('editModal');
            const content = document.getElementById('editContent');
            
            content.innerHTML = `
                <div class="space-y-8">
                    <div>
                        <label class="block text-gray-700 font-bold mb-4 text-xl">Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ</label>
                        <input type="text" id="editName" value="${student.name}" 
                               class="modern-input w-full px-8 py-5 rounded-2xl focus:ring-4 focus:ring-blue-500/50 focus:border-transparent text-xl font-medium">
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div>
                            <label class="block text-gray-700 font-bold mb-4 text-xl">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</label>
                            <select id="editMainGroup" 
                                    class="modern-input w-full px-8 py-5 rounded-2xl focus:ring-4 focus:ring-blue-500/50 focus:border-transparent text-xl font-medium">
                                <option value="A1" ${student.mainGroup === 'A1' ? 'selected' : ''}>A1</option>
                                <option value="A2" ${student.mainGroup === 'A2' ? 'selected' : ''}>A2</option>
                                <option value="B1" ${student.mainGroup === 'B1' ? 'selected' : ''}>B1</option>
                                <option value="B2" ${student.mainGroup === 'B2' ? 'selected' : ''}>B2</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 font-bold mb-4 text-xl">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ©</label>
                            <select id="editSubGroup" 
                                    class="modern-input w-full px-8 py-5 rounded-2xl focus:ring-4 focus:ring-blue-500/50 focus:border-transparent text-xl font-medium">
                                <option value="1" ${student.subGroup === '1' ? 'selected' : ''}>Subgroup 1</option>
                                <option value="2" ${student.subGroup === '2' ? 'selected' : ''}>Subgroup 2</option>
                                <option value="3" ${student.subGroup === '3' ? 'selected' : ''}>Subgroup 3</option>
                                <option value="4" ${student.subGroup === '4' ? 'selected' : ''}>Subgroup 4</option>
                                <option value="5" ${student.subGroup === '5' ? 'selected' : ''}>Subgroup 5</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 pt-8">
                        <button onclick="saveStudentChanges()" 
                                class="bg-gradient-to-r from-green-500 to-emerald-600 text-white py-5 px-8 rounded-2xl font-bold hover:from-green-600 hover:to-emerald-700 transition-all shadow-xl text-lg">
                            ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
                        </button>
                        <button onclick="deleteStudent()" 
                                class="bg-gradient-to-r from-red-500 to-rose-600 text-white py-5 px-8 rounded-2xl font-bold hover:from-red-600 hover:to-rose-700 transition-all shadow-xl text-lg">
                            ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨
                        </button>
                        <button onclick="closeEditModal()" 
                                class="bg-gradient-to-r from-gray-500 to-gray-600 text-white py-5 px-8 rounded-2xl font-bold hover:from-gray-600 hover:to-gray-700 transition-all shadow-xl text-lg">
                            âŒ Ø¥Ù„ØºØ§Ø¡
                        </button>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
        }

        // Close edit modal
        function closeEditModal() {
            document.getElementById('editModal').classList.add('hidden');
            currentEditingStudent = null;
        }

        // Save student changes
        function saveStudentChanges() {
            const newName = document.getElementById('editName').value.trim();
            const newMainGroup = document.getElementById('editMainGroup').value;
            const newSubGroup = document.getElementById('editSubGroup').value;
            
            if (!newName) {
                alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… ØµØ­ÙŠØ­');
                return;
            }
            
            // Check if new subgroup is full (excluding current student)
            const studentsInNewSubgroup = students.filter(s => 
                s.mainGroup === newMainGroup && 
                s.subGroup === newSubGroup && 
                s.id !== currentEditingStudent.id
            );
            
            if (studentsInNewSubgroup.length >= 10) {
                alert('Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù…ÙƒØªÙ…Ù„Ø©');
                return;
            }
            
            // Update student
            const studentIndex = students.findIndex(s => s.id === currentEditingStudent.id);
            students[studentIndex].name = newName;
            students[studentIndex].mainGroup = newMainGroup;
            students[studentIndex].subGroup = newSubGroup;
            
            // Save to Firebase and localStorage
            saveStudentsToFirebase().then(() => {
                closeEditModal();
                displayStudents();
                generateGroupsTable();
                updateStatistics();
                alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
            }).catch(error => {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª:', error);
                alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹ØŒ Ù„ÙƒÙ† Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Ø§Ù„Ø®Ø§Ø¯Ù…');
                closeEditModal();
                displayStudents();
                generateGroupsTable();
                updateStatistics();
            });
        }

        // Delete student
        function deleteStudent() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨ØŸ')) {
                students = students.filter(s => s.id !== currentEditingStudent.id);
                
                // Save to Firebase and localStorage
                saveStudentsToFirebase().then(() => {
                    closeEditModal();
                    displayStudents();
                    generateGroupsTable();
                    updateStatistics();
                    alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
                }).catch(error => {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨:', error);
                    alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨ Ù…Ø­Ù„ÙŠØ§Ù‹ØŒ Ù„ÙƒÙ† Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Ø§Ù„Ø®Ø§Ø¯Ù…');
                    closeEditModal();
                    displayStudents();
                    generateGroupsTable();
                    updateStatistics();
                });
            }
        }

        // Update statistics
        function updateStatistics() {
            const totalStudents = students.length;
            const groups = {};
            
            // Count students in each subgroup
            students.forEach(student => {
                const key = `${student.mainGroup}-${student.subGroup}`;
                groups[key] = (groups[key] || 0) + 1;
            });
            
            let fullGroups = 0;
            let partialGroups = 0;
            let emptyGroups = 0;
            
            // Check all possible groups (4 main groups Ã— 5 subgroups = 20 total)
            const mainGroups = ['A1', 'A2', 'B1', 'B2'];
            const subGroups = ['1', '2', '3', '4', '5'];
            
            mainGroups.forEach(mainGroup => {
                subGroups.forEach(subGroup => {
                    const key = `${mainGroup}-${subGroup}`;
                    const count = groups[key] || 0;
                    
                    if (count === 10) {
                        fullGroups++;
                    } else if (count > 0) {
                        partialGroups++;
                    } else {
                        emptyGroups++;
                    }
                });
            });
            
            // Update the statistics display
            document.getElementById('totalStudents').textContent = totalStudents;
            document.getElementById('fullGroups').textContent = fullGroups;
            document.getElementById('partialGroups').textContent = partialGroups;
            document.getElementById('emptyGroups').textContent = emptyGroups;
        }

        // Admin functions
        function checkAdminAccess() {
            const password = document.getElementById('adminPassword').value;
            
            if (password === ADMIN_PASSWORD) {
                isAdminMode = true;
                document.getElementById('adminPanel').classList.remove('hidden');
                document.getElementById('adminPassword').value = '';
                alert('ØªÙ… Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø¨Ù†Ø¬Ø§Ø­');
            } else {
                alert('Ø±Ù…Ø² Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ØºÙŠØ± ØµØ­ÙŠØ­');
            }
        }

        // Export data to Excel
        function exportData() {
            try {
                if (students.length === 0) {
                    alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±');
                    return;
                }
                
                // Check if XLSX is loaded
                if (typeof XLSX === 'undefined') {
                    alert('Ù…ÙƒØªØ¨Ø© Excel ØºÙŠØ± Ù…Ø­Ù…Ù„Ø©. ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© ÙˆØ§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
                    return;
                }
                
                const ws = XLSX.utils.json_to_sheet(students.map(student => ({
                    'Ø§Ù„Ø§Ø³Ù…': student.name,
                    'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©': student.mainGroup,
                    'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ©': student.subGroup,
                    'ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„': student.registrationDate,
                    'Ù…Ø­Ù…ÙŠ Ø¨ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±': student.password ? 'Ù†Ø¹Ù…' : 'Ù„Ø§'
                })));
                
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø±Ø§Ø¨Ø¹Ø©');
                
                const fileName = `Ø·Ù„Ø§Ø¨_Ø§Ù„Ù…Ø±Ø­Ù„Ø©_Ø§Ù„Ø±Ø§Ø¨Ø¹Ø©_${new Date().toISOString().split('T')[0]}.xlsx`;
                XLSX.writeFile(wb, fileName);
                
                alert('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!');
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
            }
        }

        // Import data from Excel
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Check if XLSX is loaded
            if (typeof XLSX === 'undefined') {
                alert('Ù…ÙƒØªØ¨Ø© Excel ØºÙŠØ± Ù…Ø­Ù…Ù„Ø©. ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© ÙˆØ§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, {type: 'array'});
                    const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);
                    
                    if (jsonData.length === 0) {
                        alert('Ø§Ù„Ù…Ù„Ù ÙØ§Ø±Øº Ø£Ùˆ Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª ØµØ§Ù„Ø­Ø©.');
                        return;
                    }
                    
                    // Convert imported data to our format
                    const importedStudents = jsonData.map((row, index) => ({
                        id: Date.now() + index,
                        name: row['Ø§Ù„Ø§Ø³Ù…'] || row['Name'] || `Ø·Ø§Ù„Ø¨ ${index + 1}`,
                        password: '',
                        mainGroup: row['Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©'] || row['Main Group'] || 'A1',
                        subGroup: row['Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ©'] || row['Sub Group'] || '1',
                        registrationDate: new Date().toLocaleDateString('ar-SA')
                    })).filter(student => student.name.trim() !== '');
                    
                    if (importedStudents.length === 0) {
                        alert('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª ØµØ§Ù„Ø­Ø© ÙÙŠ Ø§Ù„Ù…Ù„Ù.');
                        return;
                    }
                    
                    students = [...students, ...importedStudents];
                    
                    // Save to Firebase and localStorage
                    saveStudentsToFirebase().then(() => {
                        displayStudents();
                        generateGroupsTable();
                        updateStatistics();
                        alert(`ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ ${importedStudents.length} Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­`);
                    }).catch(error => {
                        console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø©:', error);
                        displayStudents();
                        generateGroupsTable();
                        updateStatistics();
                        alert(`ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ ${importedStudents.length} Ø·Ø§Ù„Ø¨ Ù…Ø­Ù„ÙŠØ§Ù‹ØŒ Ù„ÙƒÙ† Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Ø§Ù„Ø®Ø§Ø¯Ù…`);
                    });
                    
                    // Reset file input
                    event.target.value = '';
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                    alert('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØµÙŠØºØ© Ø§Ù„Ù…Ù„Ù ÙˆØ§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
                }
            };
            
            reader.onerror = function() {
                alert('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
            };
            
            reader.readAsArrayBuffer(file);
        }

        // Clear all data
        function clearAllData() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.')) {
                students = [];
                
                // Clear from Firebase and localStorage
                const clearPromise = isFirebaseConnected ? 
                    db.ref('students').remove() : 
                    Promise.resolve();
                
                clearPromise.then(() => {
                    localStorage.removeItem('students');
                    displayStudents();
                    generateGroupsTable();
                    updateStatistics();
                    alert('ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
                }).catch(error => {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                    localStorage.removeItem('students');
                    displayStudents();
                    generateGroupsTable();
                    updateStatistics();
                    alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹ØŒ Ù„ÙƒÙ† Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Ø§Ù„Ø®Ø§Ø¯Ù…');
                });
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeEditModal();
                closePasswordModal();
            }
        });

        // Auto-save functionality
        setInterval(() => {
            localStorage.setItem('students', JSON.stringify(students));
        }, 30000); // Save every 30 seconds
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97a5168cd020f937',t:'MTc1NzA2ODYxMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
