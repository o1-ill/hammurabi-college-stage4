<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ŸÜÿ∏ÿßŸÖ ÿ•ÿØÿßÿ±ÿ© Ÿàÿ™ŸÜÿ∏ŸäŸÖ ÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿ±ÿ≠ŸÑÿ© ÿßŸÑÿ±ÿßÿ®ÿπÿ© ŸÅŸä ŸÖÿ¨ŸÖŸàÿπÿßÿ™ ÿØÿ±ÿßÿ≥Ÿäÿ©">
    <meta name="keywords" content="ÿ∑ŸÑÿßÿ®, ŸÖÿ¨ŸÖŸàÿπÿßÿ™, ÿ™ŸÜÿ∏ŸäŸÖ, ÿ•ÿØÿßÿ±ÿ©, ÿ¨ÿßŸÖÿπÿ©">
    <meta name="author" content="ŸÜÿ∏ÿßŸÖ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ∑ŸÑÿßÿ®">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>ÿ™ŸÇÿ≥ŸäŸÖ ÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿ±ÿ≠ŸÑÿ© ÿßŸÑÿ±ÿßÿ®ÿπÿ©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'cairo': ['Cairo', 'sans-serif'],
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'glow': 'glow 2s ease-in-out infinite alternate',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'bounce-slow': 'bounce 3s infinite',
                        'gradient': 'gradient 15s ease infinite',
                    }
                }
            }
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" integrity="sha512-r22gChDnGvBylk90+2e/ycr3RVrDi8DIOkIGNhJlKfuyQM4tIRAI062MaV8sfjQKYVGjOBaZBOA87z+IhZE9DA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
    <!-- Firebase App (core SDK) -->
    <script src="https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js"></script>
    
    <!-- Firebase Realtime Database -->
    <script src="https://www.gstatic.com/firebasejs/12.2.1/firebase-database.js"></script>
    
    <!-- Firebase Analytics (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä) -->
    <script src="https://www.gstatic.com/firebasejs/12.2.1/firebase-analytics.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Cairo', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            font-family: 'Cairo', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(-45deg, #667eea, #764ba2, #f093fb, #f5576c, #4facfe, #00f2fe);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
            min-height: 100vh;
        }
        
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        @keyframes glow {
            from { box-shadow: 0 0 20px rgba(255, 255, 255, 0.2); }
            to { box-shadow: 0 0 30px rgba(255, 255, 255, 0.4), 0 0 40px rgba(255, 255, 255, 0.2); }
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 25px 45px rgba(0, 0, 0, 0.1);
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .glass-card:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-10px);
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.2);
        }
        
        .stats-card-1 {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .stats-card-2 {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .stats-card-3 {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        .stats-card-4 {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }
        
        .floating-element {
            animation: float 6s ease-in-out infinite;
        }
        
        .modern-input {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        
        .modern-input:focus {
            background: rgba(255, 255, 255, 0.95);
            border-color: #667eea;
            box-shadow: 0 0 30px rgba(102, 126, 234, 0.3);
        }
        
        .modern-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .modern-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 20px 40px rgba(102, 126, 234, 0.4);
        }
        
        .modern-button:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .modern-button:hover:before {
            left: 100%;
        }
        
        .table-modern {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .table-modern th {
            background: rgba(102, 126, 234, 0.2);
            color: #1f2937;
            font-weight: 700;
        }
        
        .table-modern tr:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .modal-backdrop {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
        }
        
        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .group-card-empty {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.8) 0%, rgba(21, 128, 61, 0.8) 100%);
            color: white;
        }
        
        .group-card-partial {
            background: linear-gradient(135deg, rgba(234, 179, 8, 0.8) 0%, rgba(161, 98, 7, 0.8) 100%);
            color: white;
        }
        
        .group-card-full {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.8) 0%, rgba(185, 28, 28, 0.8) 100%);
            color: white;
        }
        
        .connection-status {
            animation: pulse-slow 3s infinite;
        }
        
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        
        .admin-panel {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .glow-animation {
            animation: glow 3s ease-in-out;
        }
        
        .success-modal {
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateY(-100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .fade-out {
            animation: fadeOut 0.5s ease-in forwards;
        }
        
        @keyframes fadeOut {
            to { opacity: 0; transform: translateY(-20px); }
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-left: 8px;
        }
        
        .status-full { background-color: #ef4444; }
        .status-empty { background-color: #22c55e; }
        .status-partial { background-color: #eab308; }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }
        
        /* ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ© ŸÑŸÑÿπŸÜÿßÿµÿ± */
        .neon-glow {
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.5);
        }
        
        .pulse-glow {
            animation: pulse-glow 2s infinite;
        }
        
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(102, 126, 234, 0.3); }
            50% { box-shadow: 0 0 40px rgba(102, 126, 234, 0.8); }
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Header -->
    <header class="glass-effect text-white py-12 shadow-2xl relative overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-r from-purple-600/20 to-blue-600/20"></div>
        <div class="container mx-auto px-6 relative z-10">
            <div class="flex justify-between items-center mb-6">
                <div class="floating-element">
                    <div class="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center backdrop-blur-sm">
                        <span class="text-3xl">üéì</span>
                    </div>
                </div>
                <div id="connectionStatus" class="connection-status flex items-center gap-3 text-sm font-medium bg-white/10 px-4 py-2 rounded-full backdrop-blur-sm">
                    <span class="w-3 h-3 rounded-full bg-yellow-400 animate-pulse"></span>
                    <span>ÿ¨ÿßÿ±Ÿä ÿßŸÑÿßÿ™ÿµÿßŸÑ...</span>
                </div>
            </div>
            <div class="text-center">
                <h1 class="text-6xl font-black mb-4 text-white drop-shadow-2xl">
                    ÿ™ŸÇÿ≥ŸäŸÖ ÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿ±ÿ≠ŸÑÿ© ÿßŸÑÿ±ÿßÿ®ÿπÿ©
                </h1>
                <p class="text-xl text-white/90 font-medium">ŸÜÿ∏ÿßŸÖ ÿ•ÿØÿßÿ±ÿ© Ÿàÿ™ŸÜÿ∏ŸäŸÖ ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿßÿ™ ÿßŸÑÿØÿ±ÿßÿ≥Ÿäÿ© ÿßŸÑŸÖÿ™ÿ∑Ÿàÿ±</p>
                <div class="w-32 h-1 bg-white/50 rounded-full mx-auto mt-6"></div>
            </div>
        </div>
    </header>

    <!-- Statistics -->
    <div class="container mx-auto px-6 py-12">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-16">
            <div class="stats-card-1 text-white p-8 rounded-3xl shadow-2xl card-hover glass-card neon-glow">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm opacity-90 font-semibold mb-3 uppercase tracking-wider">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ∑ŸÑÿßÿ®</p>
                        <p class="text-4xl font-black mb-2" id="totalStudents">0</p>
                        <div class="w-16 h-1 bg-white/40 rounded-full"></div>
                    </div>
                    <div class="text-5xl floating-element opacity-80">üë•</div>
                </div>
            </div>
            
            <div class="stats-card-2 text-white p-8 rounded-3xl shadow-2xl card-hover glass-card neon-glow">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm opacity-90 font-semibold mb-3 uppercase tracking-wider">ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿßÿ™ ÿßŸÑŸÖŸÉÿ™ŸÖŸÑÿ©</p>
                        <p class="text-4xl font-black mb-2" id="fullGroups">0</p>
                        <div class="w-16 h-1 bg-white/40 rounded-full"></div>
                    </div>
                    <div class="text-5xl floating-element opacity-80">‚úÖ</div>
                </div>
            </div>
            
            <div class="stats-card-3 text-white p-8 rounded-3xl shadow-2xl card-hover glass-card neon-glow">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm opacity-90 font-semibold mb-3 uppercase tracking-wider">ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿßÿ™ ÿßŸÑÿ¨ÿ≤ÿ¶Ÿäÿ©</p>
                        <p class="text-4xl font-black mb-2" id="partialGroups">0</p>
                        <div class="w-16 h-1 bg-white/40 rounded-full"></div>
                    </div>
                    <div class="text-5xl floating-element opacity-80">‚ö†Ô∏è</div>
                </div>
            </div>
            
            <div class="stats-card-4 text-white p-8 rounded-3xl shadow-2xl card-hover glass-card neon-glow">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm opacity-90 font-semibold mb-3 uppercase tracking-wider">ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿßÿ™ ÿßŸÑŸÅÿßÿ±ÿ∫ÿ©</p>
                        <p class="text-4xl font-black mb-2" id="emptyGroups">20</p>
                        <div class="w-16 h-1 bg-white/40 rounded-full"></div>
                    </div>
                    <div class="text-5xl floating-element opacity-80">üìù</div>
                </div>
            </div>
        </div>

        <!-- Groups Overview Table -->
        <div class="glass-effect rounded-3xl shadow-2xl p-10 mb-16 neon-glow">
            <div class="flex items-center gap-6 mb-10">
                <div class="w-16 h-16 bg-gradient-to-r from-blue-500 to-purple-600 rounded-3xl flex items-center justify-center shadow-lg floating-element">
                    <span class="text-3xl">üìä</span>
                </div>
                <div>
                    <h2 class="text-4xl font-black gradient-text mb-2">ŸÜÿ∏ÿ±ÿ© ÿπÿßŸÖÿ© ÿπŸÑŸâ ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿßÿ™</h2>
                    <p class="text-white/80 text-lg">ÿ™ŸÅÿßÿµŸäŸÑ ÿ™Ÿàÿ≤Ÿäÿπ ÿßŸÑÿ∑ŸÑÿßÿ® ÿπŸÑŸâ ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿßÿ™ ÿßŸÑŸÖÿÆÿ™ŸÑŸÅÿ©</p>
                </div>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-center table-modern rounded-2xl overflow-hidden shadow-xl">
                    <thead>
                        <tr class="table-modern">
                            <th class="py-6 px-8 font-black text-lg text-white">ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©</th>
                            <th class="py-6 px-8 font-black text-lg text-white">ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿ© ÿßŸÑŸÅÿ±ÿπŸäÿ©</th>
                            <th class="py-6 px-8 font-black text-lg text-white">ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿßÿ™ ÿßŸÑÿµÿ∫Ÿäÿ±ÿ©</th>
                            <th class="py-6 px-8 font-black text-lg text-white">ÿπÿØÿØ ÿßŸÑÿ∑ŸÑÿßÿ®</th>
                            <th class="py-6 px-8 font-black text-lg text-white">ÿßŸÑÿ≠ÿßŸÑÿ©</th>
                        </tr>
                    </thead>
                    <tbody id="groupsTable">
                        <!-- Table content will be generated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Registration Form -->
        <div class="glass-effect rounded-3xl shadow-2xl p-12 mb-16 neon-glow">
            <div class="flex items-center gap-6 mb-10">
                <div class="w-16 h-16 bg-gradient-to-r from-green-500 to-blue-600 rounded-3xl flex items-center justify-center shadow-lg floating-element">
                    <span class="text-3xl">‚úèÔ∏è</span>
                </div>
                <div>
                    <h2 class="text-4xl font-black gradient-text mb-2">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿ∑ÿßŸÑÿ® ÿ¨ÿØŸäÿØ</h2>
                    <p class="text-white/80 text-lg">ÿ£ÿ∂ŸÅ ÿ∑ÿßŸÑÿ® ÿ¨ÿØŸäÿØ ÿ•ŸÑŸâ ÿßŸÑŸÜÿ∏ÿßŸÖ</p>
                </div>
            </div>
            <form id="studentForm" class="space-y-8">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div>
                        <label class="block text-white font-bold mb-4 text-xl">ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑÿ´ŸÑÿßÿ´Ÿä *</label>
                        <input type="text" id="studentName" required 
                               class="modern-input w-full px-8 py-5 rounded-2xl focus:ring-4 focus:ring-blue-500/50 focus:border-transparent transition-all text-xl font-medium"
                               placeholder="ÿ£ÿØÿÆŸÑ ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑÿ´ŸÑÿßÿ´Ÿä ŸÑŸÑÿ∑ÿßŸÑÿ®">
                    </div>
                    
                    <div>
                        <label class="block text-white font-bold mb-4 text-xl">ÿßŸÑÿ±ŸÖÿ≤ ÿßŸÑÿ≥ÿ±Ÿä (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)</label>
                        <input type="password" id="studentPassword" 
                               class="modern-input w-full px-8 py-5 rounded-2xl focus:ring-4 focus:ring-blue-500/50 focus:border-transparent transition-all text-xl font-medium"
                               placeholder="ÿ£ÿØÿÆŸÑ ÿ±ŸÖÿ≤ ÿ≥ÿ±Ÿä ŸÑÿ≠ŸÖÿßŸäÿ© ÿ®ŸäÿßŸÜÿßÿ™ŸÉ">
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div>
                        <label class="block text-white font-bold mb-4 text-xl">ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© *</label>
                        <select id="mainGroup" required 
                                class="modern-input w-full px-8 py-5 rounded-2xl focus:ring-4 focus:ring-blue-500/50 focus:border-transparent transition-all text-xl font-medium">
                            <option value="">ÿßÿÆÿ™ÿ± ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©</option>
                            <option value="A1">A1</option>
                            <option value="A2">A2</option>
                            <option value="B1">B1</option>
                            <option value="B2">B2</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-white font-bold mb-4 text-xl">ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿ© ÿßŸÑŸÅÿ±ÿπŸäÿ© *</label>
                        <select id="subGroup" required 
                                class="modern-input w-full px-8 py-5 rounded-2xl focus:ring-4 focus:ring-blue-500/50 focus:border-transparent transition-all text-xl font-medium">
                            <option value="">ÿßÿÆÿ™ÿ± ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿ© ÿßŸÑŸÅÿ±ÿπŸäÿ©</option>
                            <option value="1">Subgroup 1</option>
                            <option value="2">Subgroup 2</option>
                            <option value="3">Subgroup 3</option>
                            <option value="4">Subgroup 4</option>
                            <option value="5">Subgroup 5</option>
                        </select>
                    </div>
                </div>
                
                <button type="submit" 
                        class="modern-button w-full text-white py-6 px-10 rounded-2xl font-black text-2xl shadow-2xl pulse-glow">
                    üöÄ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ∑ÿßŸÑÿ® ÿßŸÑÿ¢ŸÜ
                </button>
            </form>
        </div>

        <!-- Admin Panel -->
        <div class="glass-effect rounded-3xl shadow-2xl p-12 mb-16 neon-glow">
            <div class="flex items-center gap-6 mb-10">
                <div class="w-16 h-16 bg-gradient-to-r from-red-500 to-pink-600 rounded-3xl flex items-center justify-center shadow-lg floating-element">
                    <span class="text-3xl">üîê</span>
                </div>
                <div>
                    <h2 class="text-4xl font-black gradient-text mb-2">ŸÑŸàÿ≠ÿ© ÿßŸÑÿ•ÿØÿßÿ±ÿ©</h2>
                    <p class="text-white/80 text-lg">ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸàÿßŸÑÿ™ÿ≠ŸÉŸÖ ŸÅŸä ÿßŸÑŸÜÿ∏ÿßŸÖ</p>
                </div>
            </div>
            <div class="flex flex-col sm:flex-row gap-6 mb-8">
                <input type="password" id="adminPassword" 
                       class="modern-input flex-1 px-8 py-5 rounded-2xl focus:ring-4 focus:ring-red-500/50 focus:border-transparent transition-all text-xl font-medium"
                       placeholder="ÿ£ÿØÿÆŸÑ ÿ±ŸÖÿ≤ ÿßŸÑÿ•ÿØÿßÿ±ÿ©">
                <button onclick="checkAdminAccess()" 
                        class="bg-gradient-to-r from-red-500 to-pink-600 text-white px-10 py-5 rounded-2xl font-bold hover:from-red-600 hover:to-pink-700 transition-all shadow-xl text-xl">
                    üîì ÿØÿÆŸàŸÑ ÿßŸÑÿ•ÿØÿßÿ±ÿ©
                </button>
            </div>
            
            <div id="adminPanel" class="admin-panel hidden p-8 rounded-2xl">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <button onclick="exportData()" 
                            class="bg-gradient-to-r from-green-500 to-emerald-600 text-white px-8 py-5 rounded-2xl font-bold hover:from-green-600 hover:to-emerald-700 transition-all flex items-center justify-center gap-4 shadow-xl text-lg">
                        üìä ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
                    </button>
                    <label class="bg-gradient-to-r from-blue-500 to-cyan-600 text-white px-8 py-5 rounded-2xl font-bold hover:from-blue-600 hover:to-cyan-700 transition-all cursor-pointer flex items-center justify-center gap-4 shadow-xl text-lg">
                        üìÅ ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
                        <input type="file" id="importFile" accept=".xlsx,.xls" class="hidden" onchange="importData(event)">
                    </label>
                    <button onclick="clearAllData()" 
                            class="bg-gradient-to-r from-red-500 to-rose-600 text-white px-8 py-5 rounded-2xl font-bold hover:from-red-600 hover:to-rose-700 transition-all flex items-center justify-center gap-4 shadow-xl text-lg">
                        üóëÔ∏è ŸÖÿ≥ÿ≠ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
                    </button>
                </div>
            </div>
        </div>

        <!-- Students Display -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8" id="studentsDisplay">
            <!-- Students will be displayed here -->
        </div>
    </div>

    <!-- Loading Indicator -->
    <div id="loadingIndicator" class="modal-backdrop fixed inset-0 flex items-center justify-center z-50 hidden">
        <div class="modal-content rounded-3xl p-12 text-center shadow-2xl">
            <div class="animate-spin rounded-full h-20 w-20 border-4 border-blue-500 border-t-transparent mx-auto mb-8"></div>
            <p class="text-gray-700 text-xl font-bold">ÿ¨ÿßÿ±Ÿä ÿßŸÑŸÖÿπÿßŸÑÿ¨ÿ©...</p>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="modal-backdrop fixed inset-0 flex items-center justify-center z-50 hidden">
        <div class="success-modal modal-content rounded-3xl p-16 max-w-md mx-4 text-center shadow-2xl">
            <div class="text-8xl mb-8 floating-element">üéâ</div>
            <h3 class="text-4xl font-black text-green-600 mb-6">ÿ™ŸÖ ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ ÿ®ŸÜÿ¨ÿßÿ≠!</h3>
            <p class="text-gray-600 text-xl font-medium">ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ∑ÿßŸÑÿ® ÿ•ŸÑŸâ ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿ© ÿßŸÑŸÖÿ≠ÿØÿØÿ©</p>
            <div class="w-20 h-2 bg-green-500 rounded-full mx-auto mt-8"></div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal-backdrop fixed inset-0 flex items-center justify-center z-50 hidden">
        <div class="modal-content rounded-3xl p-12 max-w-2xl mx-4 w-full shadow-2xl">
            <div class="flex items-center gap-6 mb-10">
                <div class="w-16 h-16 bg-gradient-to-r from-blue-500 to-purple-600 rounded-3xl flex items-center justify-center shadow-lg">
                    <span class="text-3xl">‚úèÔ∏è</span>
                </div>
                <h3 class="text-3xl font-black gradient-text">ÿ™ÿπÿØŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ∑ÿßŸÑÿ®</h3>
            </div>
            <div id="editContent">
                <!-- Edit form will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Password Modal -->
    <div id="passwordModal" class="modal-backdrop fixed inset-0 flex items-center justify-center z-50 hidden">
        <div class="modal-content rounded-3xl p-12 max-w-md mx-4 w-full shadow-2xl">
            <div class="flex items-center gap-6 mb-10">
                <div class="w-16 h-16 bg-gradient-to-r from-yellow-500 to-orange-600 rounded-3xl flex items-center justify-center shadow-lg">
                    <span class="text-3xl">üîí</span>
                </div>
                <h3 class="text-3xl font-black gradient-text">ÿ£ÿØÿÆŸÑ ÿßŸÑÿ±ŸÖÿ≤ ÿßŸÑÿ≥ÿ±Ÿä</h3>
            </div>
            <input type="password" id="modalPassword" 
                   class="modern-input w-full px-8 py-5 rounded-2xl focus:ring-4 focus:ring-blue-500/50 focus:border-transparent mb-8 text-xl font-medium"
                   placeholder="ÿßŸÑÿ±ŸÖÿ≤ ÿßŸÑÿ≥ÿ±Ÿä">
            <div class="flex gap-6">
                <button onclick="verifyPassword()" 
                        class="flex-1 bg-gradient-to-r from-blue-500 to-purple-600 text-white py-4 px-8 rounded-2xl font-bold hover:from-blue-600 hover:to-purple-700 transition-all shadow-xl text-lg">
                    ‚úÖ ÿ™ÿ£ŸÉŸäÿØ
                </button>
                <button onclick="closePasswordModal()" 
                        class="flex-1 bg-gradient-to-r from-gray-500 to-gray-600 text-white py-4 px-8 rounded-2xl font-bold hover:from-gray-600 hover:to-gray-700 transition-all shadow-xl text-lg">
                    ‚ùå ÿ•ŸÑÿ∫ÿßÿ°
                </button>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCDZZqUzXRAwh3RKaGp1unIbUWYMWF2Q7s",
            authDomain: "hammurabi-ccf6d.firebaseapp.com",
            databaseURL: "https://hammurabi-ccf6d-default-rtdb.firebaseio.com",
            projectId: "hammurabi-ccf6d",
            storageBucket: "hammurabi-ccf6d.appspot.com",
            messagingSenderId: "257971367886",
            appId: "1:257971367886:web:761013b57defa59a3b459f",
            measurementId: "G-KS3SWR8LYC"
        };

        // Initialize Firebase
        let app, db;
        let isFirebaseConnected = false;
        
        try {
            app = firebase.initializeApp(firebaseConfig);
            db = firebase.database();
            isFirebaseConnected = true;
            console.log('Firebase ŸÖÿ™ÿµŸÑ ÿ®ŸÜÿ¨ÿßÿ≠');
            updateConnectionStatus(true);
        } catch (error) {
            console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ŸÄ Firebase:', error);
            isFirebaseConnected = false;
            updateConnectionStatus(false);
        }
        
        // Update connection status indicator
        function updateConnectionStatus(connected) {
            const statusElement = document.getElementById('connectionStatus');
            if (!statusElement) return;
            
            if (connected) {
                statusElement.innerHTML = `
                    <span class="w-3 h-3 rounded-full bg-green-400 shadow-lg"></span>
                    <span class="font-bold">ŸÖÿ™ÿµŸÑ ÿ®ÿßŸÑÿÆÿßÿØŸÖ</span>
                `;
                statusElement.className = 'connection-status flex items-center gap-3 text-sm font-medium text-green-100 bg-green-500/20 px-4 py-2 rounded-full backdrop-blur-sm';
            } else {
                statusElement.innerHTML = `
                    <span class="w-3 h-3 rounded-full bg-red-400 animate-pulse shadow-lg"></span>
                    <span class="font-bold">ÿ∫Ÿäÿ± ŸÖÿ™ÿµŸÑ (Ÿàÿ∂ÿπ ŸÖÿ≠ŸÑŸä)</span>
                `;
                statusElement.className = 'connection-status flex items-center gap-3 text-sm font-medium text-red-100 bg-red-500/20 px-4 py-2 rounded-full backdrop-blur-sm';
            }
        }

        // Global variables
        let students = [];
        let currentEditingStudent = null;
        let isAdminMode = false;
        const ADMIN_PASSWORD = 'qfvlu10178';

        // Error handling
        window.addEventListener('error', function(e) {
            console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ:', e.error);
        });

        // Firebase Functions
        function loadStudentsFromFirebase() {
            if (!isFirebaseConnected) {
                // Fallback to localStorage
                students = JSON.parse(localStorage.getItem('students')) || [];
                return Promise.resolve();
            }
            
            return db.ref('students').once('value')
                .then(snapshot => {
                    const data = snapshot.val();
                    students = data ? Object.values(data) : [];
                    console.log('ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÖŸÜ Firebase:', students.length, 'ÿ∑ÿßŸÑÿ®');
                })
                .catch(error => {
                    console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÖŸÜ Firebase:', error);
                    // Fallback to localStorage
                    students = JSON.parse(localStorage.getItem('students')) || [];
                });
        }
        
        function saveStudentsToFirebase() {
            if (!isFirebaseConnected) {
                // Fallback to localStorage
                localStorage.setItem('students', JSON.stringify(students));
                return Promise.resolve();
            }
            
            // Convert array to object with IDs as keys for Firebase
            const studentsObj = {};
            students.forEach(student => {
                studentsObj[student.id] = student;
            });
            
            return db.ref('students').set(studentsObj)
                .then(() => {
                    console.log('ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÅŸä Firebase');
                    // Also save to localStorage as backup
                    localStorage.setItem('students', JSON.stringify(students));
                })
                .catch(error => {
                    console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ŸÅÿ∏ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÅŸä Firebase:', error);
                    // Fallback to localStorage
                    localStorage.setItem('students', JSON.stringify(students));
                });
        }
        
        function syncWithFirebase() {
            if (!isFirebaseConnected) return;
            
            // Monitor connection status
            db.ref('.info/connected').on('value', snapshot => {
                const connected = snapshot.val();
                updateConnectionStatus(connected);
                isFirebaseConnected = connected;
            });
            
            // Listen for real-time updates
            db.ref('students').on('value', snapshot => {
                const data = snapshot.val();
                const firebaseStudents = data ? Object.values(data) : [];
                
                // Only update if data is different
                if (JSON.stringify(firebaseStudents) !== JSON.stringify(students)) {
                    students = firebaseStudents;
                    displayStudents();
                    generateGroupsTable();
                    updateStatistics();
                    console.log('ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÖŸÜ Firebase');
                }
            });
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            try {
                // Load data from Firebase first
                loadStudentsFromFirebase().then(() => {
                    generateGroupsTable();
                    displayStudents();
                    updateStatistics();
                    
                    // Start real-time sync
                    syncWithFirebase();
                });
                
                // Form submission
                document.getElementById('studentForm').addEventListener('submit', function(e) {
                    e.preventDefault();
                    addStudent();
                });
                
                // Check if localStorage is available
                if (typeof(Storage) === "undefined") {
                    alert('ŸÖÿ™ÿµŸÅÿ≠ŸÉ ŸÑÿß ŸäÿØÿπŸÖ ÿßŸÑÿ™ÿÆÿ≤ŸäŸÜ ÿßŸÑŸÖÿ≠ŸÑŸä. ŸÇÿØ ŸÑÿß ÿ™ÿπŸÖŸÑ ÿ®ÿπÿ∂ ÿßŸÑŸÖŸäÿ≤ÿßÿ™ ÿ®ÿ¥ŸÉŸÑ ÿµÿ≠Ÿäÿ≠.');
                }
            } catch (error) {
                console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ:', error);
                alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ. Ÿäÿ±ÿ¨Ÿâ ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸÅÿ≠ÿ©.');
            }
        });

        // Generate groups table
        function generateGroupsTable() {
            const tableBody = document.getElementById('groupsTable');
            const mainGroups = ['A', 'B'];
            const subGroups = ['1', '2'];
            const subSubGroups = ['1', '2', '3', '4', '5'];
            
            let html = '';
            
            mainGroups.forEach(main => {
                subGroups.forEach(sub => {
                    const groupName = main + sub;
                    subSubGroups.forEach((subSub, index) => {
                        const fullGroupName = groupName + '-' + subSub;
                        const studentsInGroup = students.filter(s => 
                            s.mainGroup === groupName && s.subGroup === subSub
                        );
                        const count = studentsInGroup.length;
                        const maxCount = 10;
                        
                        let statusClass = 'status-empty';
                        let statusText = 'ŸÅÿßÿ±ÿ∫ÿ©';
                        
                        if (count === maxCount) {
                            statusClass = 'status-full';
                            statusText = 'ŸÖŸÉÿ™ŸÖŸÑÿ©';
                        } else if (count > 0) {
                            statusClass = 'status-partial';
                            statusText = 'ÿ¨ÿ≤ÿ¶Ÿäÿ©';
                        }
                        
                        html += `
                            <tr class="border-b border-white/10 hover:bg-white/10 transition-all">
                                ${index === 0 ? `<td rowspan="5" class="py-6 px-6 font-black text-xl bg-blue-500/20 text-white">${main}</td>` : ''}
                                ${index === 0 ? `<td rowspan="5" class="py-6 px-6 font-bold text-lg bg-blue-500/10 text-white">${groupName}</td>` : ''}
                                <td class="py-4 px-6 text-white font-medium">Subgroup ${subSub}</td>
                                <td class="py-4 px-6 font-bold text-lg text-white">${count}/${maxCount}</td>
                                <td class="py-4 px-6">
                                    <span class="status-indicator ${statusClass}"></span>
                                    <span class="text-sm font-medium text-white">${statusText}</span>
                                </td>
                            </tr>
                        `;
                    });
                });
            });
            
            tableBody.innerHTML = html;
        }

        // Add student
        function addStudent() {
            const name = document.getElementById('studentName').value.trim();
            const password = document.getElementById('studentPassword').value;
            const mainGroup = document.getElementById('mainGroup').value;
            const subGroup = document.getElementById('subGroup').value;
            
            if (!name || !mainGroup || !subGroup) {
                alert('Ÿäÿ±ÿ¨Ÿâ ŸÖŸÑÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©');
                return;
            }
            
            // Check if subgroup is full
            const studentsInSubgroup = students.filter(s => 
                s.mainGroup === mainGroup && s.subGroup === subGroup
            );
            
            if (studentsInSubgroup.length >= 10) {
                alert('Ÿáÿ∞Ÿá ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿ© ÿßŸÑŸÅÿ±ÿπŸäÿ© ŸÖŸÉÿ™ŸÖŸÑÿ© (10 ÿ∑ŸÑÿßÿ®). Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ŸÖÿ¨ŸÖŸàÿπÿ© ÿ£ÿÆÿ±Ÿâ.');
                return;
            }
            
            // Check if student already exists
            const existingStudent = students.find(s => s.name === name);
            if (existingStudent) {
                alert('Ÿáÿ∞ÿß ÿßŸÑÿßÿ≥ŸÖ ŸÖÿ≥ÿ¨ŸÑ ŸÖÿ≥ÿ®ŸÇÿßŸã');
                return;
            }
            
            const student = {
                id: Date.now(),
                name: name,
                password: password,
                mainGroup: mainGroup,
                subGroup: subGroup,
                registrationDate: new Date().toLocaleDateString('ar-SA')
            };
            
            students.push(student);
            
            // Save to Firebase and localStorage
            saveStudentsToFirebase().then(() => {
                // Show success animation
                showSuccessModal();
            }).catch(error => {
                console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ŸÅÿ∏ ÿßŸÑÿ∑ÿßŸÑÿ®:', error);
                alert('ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ∑ÿßŸÑÿ® ŸÖÿ≠ŸÑŸäÿßŸãÿå ŸÑŸÉŸÜ ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑŸÖÿ≤ÿßŸÖŸÜÿ© ŸÖÿπ ÿßŸÑÿÆÿßÿØŸÖ');
                showSuccessModal();
            });
            
            // Reset form
            document.getElementById('studentForm').reset();
            
            // Update displays
            displayStudents();
            generateGroupsTable();
            updateStatistics();
            
            // Highlight the student's group
            highlightStudentGroup(student);
        }

        // Show/hide loading indicator
        function showLoading() {
            document.getElementById('loadingIndicator').classList.remove('hidden');
        }
        
        function hideLoading() {
            document.getElementById('loadingIndicator').classList.add('hidden');
        }

        // Show success modal
        function showSuccessModal() {
            const modal = document.getElementById('successModal');
            modal.classList.remove('hidden');
            
            setTimeout(() => {
                modal.classList.add('fade-out');
                setTimeout(() => {
                    modal.classList.add('hidden');
                    modal.classList.remove('fade-out');
                }, 500);
            }, 3000);
        }

        // Highlight student group
        function highlightStudentGroup(student) {
            const groupCards = document.querySelectorAll(`[data-group="${student.mainGroup}-${student.subGroup}"]`);
            groupCards.forEach(card => {
                card.classList.add('glow-animation');
                setTimeout(() => {
                    card.classList.remove('glow-animation');
                }, 3000);
            });
        }

        // Display students
        function displayStudents() {
            const container = document.getElementById('studentsDisplay');
            const groups = {};
            
            // Group students by main group and subgroup
            students.forEach(student => {
                const key = `${student.mainGroup}-${student.subGroup}`;
                if (!groups[key]) {
                    groups[key] = [];
                }
                groups[key].push(student);
            });
            
            let html = '';
            
            // Create cards for all possible groups
            const mainGroups = ['A1', 'A2', 'B1', 'B2'];
            const subGroups = ['1', '2', '3', '4', '5'];
            
            mainGroups.forEach(mainGroup => {
                subGroups.forEach(subGroup => {
                    const key = `${mainGroup}-${subGroup}`;
                    const groupStudents = groups[key] || [];
                    const count = groupStudents.length;
                    const maxCount = 10;
                    
                    let cardClass = 'group-card-empty';
                    let statusIcon = 'üü¢';
                    let statusText = 'ŸÅÿßÿ±ÿ∫ÿ©';
                    
                    if (count === maxCount) {
                        cardClass = 'group-card-full';
                        statusIcon = 'üî¥';
                        statusText = 'ŸÖŸÉÿ™ŸÖŸÑÿ©';
                    } else if (count > 0) {
                        cardClass = 'group-card-partial';
                        statusIcon = 'üü°';
                        statusText = 'ÿ¨ÿ≤ÿ¶Ÿäÿ©';
                    }
                    
                    html += `
                        <div class="${cardClass} rounded-3xl shadow-2xl p-8 card-hover glass-card neon-glow" data-group="${key}">
                            <div class="flex items-center justify-between mb-8">
                                <div>
                                    <h3 class="text-2xl font-black text-white mb-3">${mainGroup} - Subgroup ${subGroup}</h3>
                                    <div class="flex items-center gap-4">
                                        <span class="text-xl font-black text-white">${count}/${maxCount}</span>
                                        <span class="text-3xl">${statusIcon}</span>
                                        <span class="text-sm font-bold text-white bg-white/20 px-4 py-2 rounded-full backdrop-blur-sm">${statusText}</span>
                                    </div>
                                </div>
                                <div class="w-20 h-20 bg-white/20 rounded-3xl flex items-center justify-center backdrop-blur-sm floating-element">
                                    <span class="text-3xl">üë•</span>
                                </div>
                            </div>
                            <div class="space-y-4 max-h-80 overflow-y-auto scrollbar-hide">
                                ${groupStudents.map(student => `
                                    <div class="flex items-center justify-between bg-white/20 backdrop-filter backdrop-blur-sm rounded-2xl p-5 hover:bg-white/30 transition-all shadow-lg">
                                        <span class="flex items-center gap-4 text-white font-bold text-lg">
                                            <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center shadow-lg">
                                                <span class="text-white text-lg">üë§</span>
                                            </div>
                                            ${student.name}
                                        </span>
                                        <button onclick="editStudent(${student.id})" 
                                                class="w-12 h-12 bg-blue-500 hover:bg-blue-600 text-white rounded-2xl transition-all flex items-center justify-center shadow-xl hover:scale-110">
                                                <span class="text-lg">‚úèÔ∏è</span>
                                        </button>
                                    </div>
                                `).join('')}
                                ${count === 0 ? '<div class="text-center py-12"><div class="text-8xl mb-6 opacity-60 floating-element">üìù</div><p class="text-white/80 text-xl font-bold">ŸÑÿß ŸäŸàÿ¨ÿØ ÿ∑ŸÑÿßÿ® ŸÖÿ≥ÿ¨ŸÑŸäŸÜ</p></div>' : ''}
                            </div>
                        </div>
                    `;
                });
            });
            
            container.innerHTML = html;
        }

        // Edit student
        function editStudent(studentId) {
            const student = students.find(s => s.id === studentId);
            if (!student) return;
            
            currentEditingStudent = student;
            
            if (student.password && !isAdminMode) {
                showPasswordModal();
            } else {
                showEditModal(student);
            }
        }

        // Show password modal
        function showPasswordModal() {
            document.getElementById('passwordModal').classList.remove('hidden');
            document.getElementById('modalPassword').focus();
        }

        // Close password modal
        function closePasswordModal() {
            document.getElementById('passwordModal').classList.add('hidden');
            document.getElementById('modalPassword').value = '';
        }

        // Verify password
        function verifyPassword() {
            const enteredPassword = document.getElementById('modalPassword').value;
            
            if (enteredPassword === currentEditingStudent.password) {
                closePasswordModal();
                showEditModal(currentEditingStudent);
            } else {
                alert('ÿßŸÑÿ±ŸÖÿ≤ ÿßŸÑÿ≥ÿ±Ÿä ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠');
            }
        }

        // Show edit modal
        function showEditModal(student) {
            const modal = document.getElementById('editModal');
            const content = document.getElementById('editContent');
            
            content.innerHTML = `
                <div class="space-y-8">
                    <div>
                        <label class="block text-gray-700 font-bold mb-4 text-xl">ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑÿ´ŸÑÿßÿ´Ÿä</label>
                        <input type="text" id="editName" value="${student.name}" 
                               class="modern-input w-full px-8 py-5 rounded-2xl focus:ring-4 focus:ring-blue-500/50 focus:border-transparent text-xl font-medium">
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div>
                            <label class="block text-gray-700 font-bold mb-4 text-xl">ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©</label>
                            <select id="editMainGroup" 
                                    class="modern-input w-full px-8 py-5 rounded-2xl focus:ring-4 focus:ring-blue-500/50 focus:border-transparent text-xl font-medium">
                                <option value="A1" ${student.mainGroup === 'A1' ? 'selected' : ''}>A1</option>
                                <option value="A2" ${student.mainGroup === 'A2' ? 'selected' : ''}>A2</option>
                                <option value="B1" ${student.mainGroup === 'B1' ? 'selected' : ''}>B1</option>
                                <option value="B2" ${student.mainGroup === 'B2' ? 'selected' : ''}>B2</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 font-bold mb-4 text-xl">ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿ© ÿßŸÑŸÅÿ±ÿπŸäÿ©</label>
                            <select id="editSubGroup" 
                                    class="modern-input w-full px-8 py-5 rounded-2xl focus:ring-4 focus:ring-blue-500/50 focus:border-transparent text-xl font-medium">
                                <option value="1" ${student.subGroup === '1' ? 'selected' : ''}>Subgroup 1</option>
                                <option value="2" ${student.subGroup === '2' ? 'selected' : ''}>Subgroup 2</option>
                                <option value="3" ${student.subGroup === '3' ? 'selected' : ''}>Subgroup 3</option>
                                <option value="4" ${student.subGroup === '4' ? 'selected' : ''}>Subgroup 4</option>
                                <option value="5" ${student.subGroup === '5' ? 'selected' : ''}>Subgroup 5</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 pt-8">
                        <button onclick="saveStudentChanges()" 
                                class="bg-gradient-to-r from-green-500 to-emerald-600 text-white py-5 px-8 rounded-2xl font-bold hover:from-green-600 hover:to-emerald-700 transition-all shadow-xl text-lg">
                            üíæ ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿ∫ŸäŸäÿ±ÿßÿ™
                        </button>
                        <button onclick="deleteStudent()" 
                                class="bg-gradient-to-r from-red-500 to-rose-600 text-white py-5 px-8 rounded-2xl font-bold hover:from-red-600 hover:to-rose-700 transition-all shadow-xl text-lg">
                            üóëÔ∏è ÿ≠ÿ∞ŸÅ ÿßŸÑÿ∑ÿßŸÑÿ®
                        </button>
                        <button onclick="closeEditModal()" 
                                class="bg-gradient-to-r from-gray-500 to-gray-600 text-white py-5 px-8 rounded-2xl font-bold hover:from-gray-600 hover:to-gray-700 transition-all shadow-xl text-lg">
                            ‚ùå ÿ•ŸÑÿ∫ÿßÿ°
                        </button>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
        }

        // Close edit modal
        function closeEditModal() {
            document.getElementById('editModal').classList.add('hidden');
            currentEditingStudent = null;
        }

        // Save student changes
        function saveStudentChanges() {
            const newName = document.getElementById('editName').value.trim();
            const newMainGroup = document.getElementById('editMainGroup').value;
            const newSubGroup = document.getElementById('editSubGroup').value;
            
            if (!newName) {
                alert('Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ÿßÿ≥ŸÖ ÿµÿ≠Ÿäÿ≠');
                return;
            }
            
            // Check if new subgroup is full (excluding current student)
            const studentsInNewSubgroup = students.filter(s => 
                s.mainGroup === newMainGroup && 
                s.subGroup === newSubGroup && 
                s.id !== currentEditingStudent.id
            );
            
            if (studentsInNewSubgroup.length >= 10) {
                alert('ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿ© ÿßŸÑŸÅÿ±ÿπŸäÿ© ÿßŸÑÿ¨ÿØŸäÿØÿ© ŸÖŸÉÿ™ŸÖŸÑÿ©');
                return;
            }
            
            // Update student
            const studentIndex = students.findIndex(s => s.id === currentEditingStudent.id);
            students[studentIndex].name = newName;
            students[studentIndex].mainGroup = newMainGroup;
            students[studentIndex].subGroup = newSubGroup;
            
            // Save to Firebase and localStorage
            saveStudentsToFirebase().then(() => {
                closeEditModal();
                displayStudents();
                generateGroupsTable();
                updateStatistics();
                alert('ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿ∫ŸäŸäÿ±ÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠');
            }).catch(error => {
                console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿ∫ŸäŸäÿ±ÿßÿ™:', error);
                alert('ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿ∫ŸäŸäÿ±ÿßÿ™ ŸÖÿ≠ŸÑŸäÿßŸãÿå ŸÑŸÉŸÜ ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑŸÖÿ≤ÿßŸÖŸÜÿ© ŸÖÿπ ÿßŸÑÿÆÿßÿØŸÖ');
                closeEditModal();
                displayStudents();
                generateGroupsTable();
                updateStatistics();
            });
        }

        // Delete student
        function deleteStudent() {
            if (confirm('ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ Ÿáÿ∞ÿß ÿßŸÑÿ∑ÿßŸÑÿ®ÿü')) {
                students = students.filter(s => s.id !== currentEditingStudent.id);
                
                // Save to Firebase and localStorage
                saveStudentsToFirebase().then(() => {
                    closeEditModal();
                    displayStudents();
                    generateGroupsTable();
                    updateStatistics();
                    alert('ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑÿ∑ÿßŸÑÿ® ÿ®ŸÜÿ¨ÿßÿ≠');
                }).catch(error => {
                    console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ÿ∞ŸÅ ÿßŸÑÿ∑ÿßŸÑÿ®:', error);
                    alert('ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑÿ∑ÿßŸÑÿ® ŸÖÿ≠ŸÑŸäÿßŸãÿå ŸÑŸÉŸÜ ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑŸÖÿ≤ÿßŸÖŸÜÿ© ŸÖÿπ ÿßŸÑÿÆÿßÿØŸÖ');
                    closeEditModal();
                    displayStudents();
                    generateGroupsTable();
                    updateStatistics();
                });
            }
        }

        // Update statistics
        function updateStatistics() {
            const totalStudents = students.length;
            const groups = {};
            
            // Count students in each subgroup
            students.forEach(student => {
                const key = `${student.mainGroup}-${student.subGroup}`;
                groups[key] = (groups[key] || 0) + 1;
            });
            
            let fullGroups = 0;
            let partialGroups = 0;
            let emptyGroups = 0;
            
            // Check all possible groups (4 main groups √ó 5 subgroups = 20 total)
            const mainGroups = ['A1', 'A2', 'B1', 'B2'];
            const subGroups = ['1', '2', '3', '4', '5'];
            
            mainGroups.forEach(mainGroup => {
                subGroups.forEach(subGroup => {
                    const key = `${mainGroup}-${subGroup}`;
                    const count = groups[key] || 0;
                    
                    if (count === 10) {
                        fullGroups++;
                    } else if (count > 0) {
                        partialGroups++;
                    } else {
                        emptyGroups++;
                    }
                });
            });
            
            // Update the statistics display
            document.getElementById('totalStudents').textContent = totalStudents;
            document.getElementById('fullGroups').textContent = fullGroups;
            document.getElementById('partialGroups').textContent = partialGroups;
            document.getElementById('emptyGroups').textContent = emptyGroups;
        }

        // Admin functions
        function checkAdminAccess() {
            const password = document.getElementById('adminPassword').value;
            
            if (password === ADMIN_PASSWORD) {
                isAdminMode = true;
                document.getElementById('adminPanel').classList.remove('hidden');
                document.getElementById('adminPassword').value = '';
                alert('ÿ™ŸÖ ÿßŸÑÿØÿÆŸàŸÑ ÿ•ŸÑŸâ ŸÑŸàÿ≠ÿ© ÿßŸÑÿ•ÿØÿßÿ±ÿ© ÿ®ŸÜÿ¨ÿßÿ≠');
            } else {
                alert('ÿ±ŸÖÿ≤ ÿßŸÑÿ•ÿØÿßÿ±ÿ© ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠');
            }
        }

        // Export data to Excel
        function exportData() {
            try {
                if (students.length === 0) {
                    alert('ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ®ŸäÿßŸÜÿßÿ™ ŸÑŸÑÿ™ÿµÿØŸäÿ±');
                    return;
                }
                
                // Check if XLSX is loaded
                if (typeof XLSX === 'undefined') {
                    alert('ŸÖŸÉÿ™ÿ®ÿ© Excel ÿ∫Ÿäÿ± ŸÖÿ≠ŸÖŸÑÿ©. Ÿäÿ±ÿ¨Ÿâ ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸÅÿ≠ÿ© ŸàÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
                    return;
                }
                
                const ws = XLSX.utils.json_to_sheet(students.map(student => ({
                    'ÿßŸÑÿßÿ≥ŸÖ': student.name,
                    'ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©': student.mainGroup,
                    'ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿ© ÿßŸÑŸÅÿ±ÿπŸäÿ©': student.subGroup,
                    'ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ': student.registrationDate,
                    'ŸÖÿ≠ŸÖŸä ÿ®ŸÉŸÑŸÖÿ© ŸÖÿ±Ÿàÿ±': student.password ? 'ŸÜÿπŸÖ' : 'ŸÑÿß'
                })));
                
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'ÿ∑ŸÑÿßÿ® ÿßŸÑŸÖÿ±ÿ≠ŸÑÿ© ÿßŸÑÿ±ÿßÿ®ÿπÿ©');
                
                const fileName = `ÿ∑ŸÑÿßÿ®_ÿßŸÑŸÖÿ±ÿ≠ŸÑÿ©_ÿßŸÑÿ±ÿßÿ®ÿπÿ©_${new Date().toISOString().split('T')[0]}.xlsx`;
                XLSX.writeFile(wb, fileName);
                
                alert('ÿ™ŸÖ ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠!');
            } catch (error) {
                console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™:', error);
                alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
            }
        }

        // Import data from Excel
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Check if XLSX is loaded
            if (typeof XLSX === 'undefined') {
                alert('ŸÖŸÉÿ™ÿ®ÿ© Excel ÿ∫Ÿäÿ± ŸÖÿ≠ŸÖŸÑÿ©. Ÿäÿ±ÿ¨Ÿâ ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸÅÿ≠ÿ© ŸàÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, {type: 'array'});
                    const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);
                    
                    if (jsonData.length === 0) {
                        alert('ÿßŸÑŸÖŸÑŸÅ ŸÅÿßÿ±ÿ∫ ÿ£Ÿà ŸÑÿß Ÿäÿ≠ÿ™ŸàŸä ÿπŸÑŸâ ÿ®ŸäÿßŸÜÿßÿ™ ÿµÿßŸÑÿ≠ÿ©.');
                        return;
                    }
                    
                    // Convert imported data to our format
                    const importedStudents = jsonData.map((row, index) => ({
                        id: Date.now() + index,
                        name: row['ÿßŸÑÿßÿ≥ŸÖ'] || row['Name'] || `ÿ∑ÿßŸÑÿ® ${index + 1}`,
                        password: '',
                        mainGroup: row['ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©'] || row['Main Group'] || 'A1',
                        subGroup: row['ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿ© ÿßŸÑŸÅÿ±ÿπŸäÿ©'] || row['Sub Group'] || '1',
                        registrationDate: new Date().toLocaleDateString('ar-SA')
                    })).filter(student => student.name.trim() !== '');
                    
                    if (importedStudents.length === 0) {
                        alert('ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿ®ŸäÿßŸÜÿßÿ™ ÿµÿßŸÑÿ≠ÿ© ŸÅŸä ÿßŸÑŸÖŸÑŸÅ.');
                        return;
                    }
                    
                    students = [...students, ...importedStudents];
                    
                    // Save to Firebase and localStorage
                    saveStudentsToFirebase().then(() => {
                        displayStudents();
                        generateGroupsTable();
                        updateStatistics();
                        alert(`ÿ™ŸÖ ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ${importedStudents.length} ÿ∑ÿßŸÑÿ® ÿ®ŸÜÿ¨ÿßÿ≠`);
                    }).catch(error => {
                        console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ŸÅÿ∏ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™Ÿàÿ±ÿØÿ©:', error);
                        displayStudents();
                        generateGroupsTable();
                        updateStatistics();
                        alert(`ÿ™ŸÖ ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ${importedStudents.length} ÿ∑ÿßŸÑÿ® ŸÖÿ≠ŸÑŸäÿßŸãÿå ŸÑŸÉŸÜ ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑŸÖÿ≤ÿßŸÖŸÜÿ© ŸÖÿπ ÿßŸÑÿÆÿßÿØŸÖ`);
                    });
                    
                    // Reset file input
                    event.target.value = '';
                } catch (error) {
                    console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™:', error);
                    alert('ÿÆÿ∑ÿ£ ŸÅŸä ŸÇÿ±ÿßÿ°ÿ© ÿßŸÑŸÖŸÑŸÅ. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿµŸäÿ∫ÿ© ÿßŸÑŸÖŸÑŸÅ ŸàÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
                }
            };
            
            reader.onerror = function() {
                alert('ÿÆÿ∑ÿ£ ŸÅŸä ŸÇÿ±ÿßÿ°ÿ© ÿßŸÑŸÖŸÑŸÅ. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');
            };
            
            reader.readAsArrayBuffer(file);
        }

        // Clear all data
        function clearAllData() {
            if (confirm('ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ÿü Ÿáÿ∞ÿß ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ° ŸÑÿß ŸäŸÖŸÉŸÜ ÿßŸÑÿ™ÿ±ÿßÿ¨ÿπ ÿπŸÜŸá.')) {
                students = [];
                
                // Clear from Firebase and localStorage
                const clearPromise = isFirebaseConnected ? 
                    db.ref('students').remove() : 
                    Promise.resolve();
                
                clearPromise.then(() => {
                    localStorage.removeItem('students');
                    displayStudents();
                    generateGroupsTable();
                    updateStatistics();
                    alert('ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠');
                }).catch(error => {
                    console.error('ÿÆÿ∑ÿ£ ŸÅŸä ŸÖÿ≥ÿ≠ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™:', error);
                    localStorage.removeItem('students');
                    displayStudents();
                    generateGroupsTable();
                    updateStatistics();
                    alert('ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÖÿ≠ŸÑŸäÿßŸãÿå ŸÑŸÉŸÜ ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑŸÖÿ≤ÿßŸÖŸÜÿ© ŸÖÿπ ÿßŸÑÿÆÿßÿØŸÖ');
                });
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeEditModal();
                closePasswordModal();
            }
        });

        // Auto-save functionality
        setInterval(() => {
            localStorage.setItem('students', JSON.stringify(students));
        }, 30000); // Save every 30 seconds
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97a5168cd020f937',t:'MTc1NzA2ODYxMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
